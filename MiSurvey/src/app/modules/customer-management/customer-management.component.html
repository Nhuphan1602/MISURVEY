<div *ngIf="isLoading$ | async" class="loading-indicator">
  <!-- Loading indicator when templates are being fetched -->
  Loading...
</div>

<div *ngIf="!(isLoading$ | async)">
  <div class="d-flex justify-content-start">
    <button class="btn-action">Export Data</button>
  </div>

  <table class="table table-hover table-striped responsive">
    <thead>
      <tr>
        <th>ID</th>
        <th>Full Name</th>
        <th>Email</th>
        <th>Phone Number</th>
        <th>Created At</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let customer of customers$ | async">
        <td>{{ customer.CustomerID }}</td>
        <td>{{ customer.FullName }}</td>
        <td>{{ customer.Email }}</td>
        <td>{{ customer.PhoneNumber }}</td>
        <td>{{ customer.CreatedAt | date:'medium' }}</td>
        <td>
          <c-dropdown class="d-flex justify-content-center">
            <span class="action-management" cDropdownToggle></span>
            <ul cDropdownMenu>
              <li><button cDropdownItem (click)="openViewModal(customer.CustomerID)">View</button></li>
              <li><button cDropdownItem (click)="openEditModal(customer.CustomerID)">Edit</button></li>
              <li><button cDropdownItem (click)="openDeleteModal(customer.CustomerID)">Delete</button></li>
            </ul>
          </c-dropdown>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="pagination">
    <button
      class="pagination-button"
      (click)="onPageChangePrevious()"
      [disabled]="currentPage === 1"
    >
      &lt;&lt; Previous
    </button>
    <div
      *ngFor="
        let page of getPaginationRange(currentPage, totalPages);
        let i = index
      "
      class="page-item"
    >
      <button
        *ngIf="page !== '...'"
        (click)="onPageChange(page)"
        [class.active]="currentPage === page"
      >
        {{ page }}
      </button>
      <span *ngIf="page === '...'">{{ page }}</span>
    </div>
    <button
      class="pagination-button"
      (click)="onPageChangeNext()"
      [disabled]="currentPage === totalPages"
    >
      Next &gt;&gt;
    </button>
  </div>


  <!-- Edit Customer Modal -->
  <c-modal
    size="lg"
    alignment="center"
    #editCustomerModal
    id="editCustomerModal"
  >
    <c-modal-header>
      <h5 cModalTitle>Edit Customer</h5>
      <button class="btn-close" [cModalToggle]="editCustomerModal.id"></button>
    </c-modal-header>
    <c-modal-body>
      <form [formGroup]="editCustomerForm">
        <!-- Assuming 'name' and 'email' are fields on the customer object -->
        <div class="mb-3">
          <label for="FullName" class="form-label">Name</label>
          <input
            type="text"
            id="fullName"
            class="form-control"
            formControlName="FullName"
          />
        </div>
        <div class="mb-3">
          <label for="Email" class="form-label">Email</label>
          <input
            type="email"
            id="email"
            class="form-control"
            formControlName="Email"
          />
        </div>
      </form>
    </c-modal-body>
    <c-modal-footer>
      <button [cModalToggle]="editCustomerModal.id" cButton color="secondary">
        Cancel
      </button>
      <button cButton color="primary" (click)="saveCustomerChanges()">
        Save Changes
      </button>
    </c-modal-footer>
  </c-modal>

  <!-- Delete Customer Modal -->
  <c-modal
    size="lg"
    alignment="center"
    #deleteCustomerModal
    id="deleteCustomerModal"
  >
    <c-modal-header>
      <h5 cModalTitle>Confirm Customer Deletion</h5>
      <button
        class="btn-close"
        [cModalToggle]="deleteCustomerModal.id"
      ></button>
    </c-modal-header>
    <c-modal-body>
      Are you sure you want to delete this customer? This action cannot be
      undone.
    </c-modal-body>
    <c-modal-footer>
      <button [cModalToggle]="deleteCustomerModal.id" cButton color="secondary">
        Cancel
      </button>
      <button cButton color="danger" (click)="deleteCustomer()">Confirm</button>
    </c-modal-footer>
  </c-modal>
</div>
